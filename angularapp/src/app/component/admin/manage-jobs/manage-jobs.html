<app-admin-sidebar></app-admin-sidebar>

<div class="admin-content-wrapper">
  <div class="admin-content-card">
    <h2>Manage Jobs</h2>

    <div class="controls-row">
      <div class="search-group">
        <input
          type="search"
          [(ngModel)]="searchTerm"
          placeholder="Search by ID, title or company..."
          aria-label="Search jobs"
        />
        <button type="button" class="btn-clear" (click)="clearSearch()" title="Clear search">✕</button>
      </div>

      <div class="filter-group">
        <label for="companyFilter">Company</label>
        <select id="companyFilter" [(ngModel)]="companyFilter" aria-label="Filter by company">
          <option value="">All companies</option>
          <option *ngFor="let c of uniqueCompanies()" [value]="c">{{ c }}</option>
        </select>

        <label for="statusFilter">Status</label>
        <select id="statusFilter" [(ngModel)]="statusFilter" aria-label="Filter by status">
          <option value="">All statuses</option>
          <option value="Active">Active</option>
          <option value="Closed">Closed</option>
          <option value="Unknown">Unknown</option>
        </select>
      </div>
    </div>

    <div *ngIf="loading" class="hint">Loading jobs…</div>
    <div *ngIf="error" class="message error">{{ error }}</div>

    <table *ngIf="!loading && filteredJobs.length > 0" class="jobs-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Company</th>
          <th>Status</th>
          <th>Posted By</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let job of filteredJobs; trackBy: trackById">
          <td data-label="ID">{{ job.id }}</td>
          <td data-label="Title">{{ job.title }}</td>
          <td data-label="Company" class="company">{{ job.companyName || '—' }}</td>
          <td data-label="Status">
            <span class="status-pill" [ngClass]="{'active': job.status === 'Active', 'closed': job.status === 'Closed'}">
              {{ job.status || '—' }}
            </span>
          </td>
          <td data-label="Posted By">
            <ng-container *ngIf="job.postedById || job.postedByName">
              <span *ngIf="job.postedById">#{{ job.postedById }}</span>
              <span *ngIf="job.postedByName"> {{ job.postedByName }}</span>
            </ng-container>
            <span *ngIf="!job.postedById && !job.postedByName">—</span>
          </td>
          <td data-label="Action" class="actions-cell">
            <button class="btn-edit" type="button" (click)="onEdit(job)">Edit</button>
            <button class="btn-delete" type="button" (click)="onDelete(job)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!loading && filteredJobs.length === 0" class="hint">No jobs found.</div>
  </div>
</div>
