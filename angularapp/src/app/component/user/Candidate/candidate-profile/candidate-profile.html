<div class="container my-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h2 class="mb-0">Your Profile</h2>
        <div class="d-flex gap-2">
          <a class="btn btn-outline-primary" routerLink="/jobs">Browse Jobs</a>
          <a class="btn btn-primary" routerLink="/candidate/onboarding">Edit Profile</a>
        </div>
      </div>

      <!-- Error -->
      <div *ngIf="!loading && error" class="alert alert-danger">{{ error }}</div>

      <div *ngIf="!loading && !error" class="row g-4">
        <!-- Sidebar -->
        <div class="col-12 col-md-4">
          <div class="card shadow-sm sticky-md-top sidebar-card">
            <div class="card-body">
              <div class="d-flex align-items-center gap-3 mb-3">
                <div class="avatar bg-primary text-white">
                  {{ (profile?.fullName || profile?.username || 'U') | slice:0:1 }}
                </div>
                <div>
                  <h5 class="mb-0">{{ profile?.fullName || profile?.username }}</h5>
                  <small class="text-muted">{{ profile?.email }}</small>
                </div>
              </div>

              <!-- Headline & Skills -->
              <div class="mb-3 profile-summary">
                <p class="mb-1">
                  <span class="text-muted">Headline:</span>
                  <span class="ms-1">{{ profile?.headline || 'â€”' }}</span>
                </p>
                <p class="mb-0">
                  <span class="text-muted">Skills:</span>
                  <span class="ms-1">{{ profile?.skills || 'â€”' }}</span>
                </p>
              </div>

              <ul class="list-unstyled small mb-3 personal-meta">
                <li class="mb-1">
                  <span class="text-muted">Phone:</span>
                  <span class="ms-1">{{ profile?.phone || 'â€”' }}</span>
                </li>
                <li class="mb-1">
                  <span class="text-muted">Location:</span>
                  <span class="ms-1">{{ profile?.location || 'â€”' }}</span>
                </li>
                <li class="mb-1">
                  <span class="text-muted">Pin / Postal:</span>
                  <span class="ms-1">{{ profile?.pinCode || 'â€”' }}</span>
                </li>
              </ul>

              <!-- Resume status + actions -->
              <div class="mb-3 resume-actions">
                <div class="mb-2">
                  <span class="resume-badge"
                        [ngClass]="profile?.resumeUrl ? 'has-resume' : 'no-resume'">
                    {{ profile?.resumeUrl ? 'Resume uploaded' : 'No resume uploaded' }}
                  </span>
                </div>

                <div class="d-flex gap-2 flex-wrap">
                  <ng-container *ngIf="profile?.resumeUrl; else noView">
                    <a class="btn btn-outline-action btn-sm"
                       [href]="profile?.resumeUrl"
                       target="_blank"
                       rel="noopener">
                      View Resume
                    </a>
                  </ng-container>
                  <ng-template #noView>
                    <button class="btn btn-outline-action btn-sm" disabled>View Resume</button>
                  </ng-template>

                  <label class="btn btn-outline-action btn-sm mb-0" for="resumeInputSidebar" [class.disabled]="uploading">
                    {{ uploading ? 'Uploadingâ€¦' : (profile?.resumeUrl ? 'Update Resume' : 'Upload Resume') }}
                  </label>
                  <input
                    id="resumeInputSidebar"
                    type="file"
                    accept=".pdf,.doc,.docx"
                    (change)="onResumeFileSelected($event)"
                    style="display:none"
                    [disabled]="uploading"
                  />
                </div>

                <div *ngIf="uploading" class="mt-2 small text-muted">
                  <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                  Uploadingâ€¦
                </div>
                <div *ngIf="uploadError" class="mt-2 text-danger small">{{ uploadError }}</div>
                <div *ngIf="uploadSuccess" class="mt-2 text-success small">Resume uploaded successfully.</div>
              </div>

              <div class="d-grid gap-2">
                <!--<a class="btn btn-primary" routerLink="/jobs">Find Jobs</a>-->
                <a class="btn btn-primary" routerLink="/companies">Explore Companies</a>
              </div>
            </div>
          </div>
        </div>

        <!-- Main -->
        <div class="col-12 col-md-8">
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <h5 class="mb-0">Application Status</h5>
                <a class="btn btn-sm btn-outline-primary" routerLink="/jobs">Apply Now</a>
              </div>
              <hr />

              <!-- No applications yet -->
              <div *ngIf="applications.length === 0" class="text-center py-4">
                <div class="display-6 mb-2">ðŸŽ¯</div>
                <p class="mb-3">You havenâ€™t applied to any jobs yet.</p>
                <a class="btn btn-primary" routerLink="/jobs">Apply for your dream job</a>
              </div>

              <!-- Applications List -->
              <ul *ngIf="applications.length > 0" class="list-group list-group-flush">
                <li
                  class="list-group-item d-flex align-items-center justify-content-between"
                  *ngFor="let app of applications; trackBy: trackById"
                >
                  <div>
                    <div class="fw-semibold">{{ app.jobTitle || app.title || 'Job' }}</div>
                    <small class="text-muted">
                      {{ app.companyName || app.company || 'Company' }} Â·
                      Applied on {{ app.appliedAt | date:'mediumDate' }}
                    </small>
                  </div>
              <!-- Status text (text-only colors) -->
                  <span class="status-badge"
                        [ngClass]="{
                          'status-pending': !app.status || app.status === 'PENDING',
                          'status-review': app.status === 'REVIEW',
                          'status-interview': app.status === 'INTERVIEW',
                          'status-approved': app.status === 'APPROVED' || app.status === 'HIRED',
                          'status-rejected': app.status === 'REJECTED'
                        }">
                    {{ app.status || 'PENDING' }}
                  </span>

                </li>
              </ul>
            </div>
          </div>
        </div>
        <!-- /Main -->
      </div>
    </div>
  </div>
</div>
